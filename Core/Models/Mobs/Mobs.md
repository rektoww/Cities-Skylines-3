# Документация по моделям мобов (Mob Models)

Этот документ описывает классы для подвижных объектов (мобов), которые перемещаются по игровой карте. Все они наследуются от базового класса `Mob`.

## Глава 1: Car.cs

`Car` представляет собой транспортное средство. В текущей реализации это базовая заглушка, и логика передвижения (`Move`) еще не реализована.

### Свойства
- `Owner`: `Citizen` — Владелец автомобиля.
- `Driver`: `Citizen` — Текущий водитель.
- Константа `DefaultCarCapacity`: 4 (1 водитель + 3 пассажира).

### Методы

- **`Move()`**: `override void`
  - Реализует движение личного транспорта. В текущей версии это временное случайное блуждание, пока не будет реализован поиск пути.
  - Важно: Метод синхронизирует координаты всех пассажиров (Passengers) и водителя (Driver) с координатами автомобиля.

## Глава 2: Citizen.cs

`Citizen` — это основной класс, представляющий жителя города. Он содержит всю ключевую информацию и логику поведения, связанную с жизнью горожанина.

### Свойства

- **`Age`**: `int` - Возраст жителя.
- **`IsMale`**: `bool` - Пол жителя.
- **`Education`**: `EducationLevel` - Уровень образования.
- **`IsStudying`**: `bool` - Флаг, указывающий, учится ли житель в данный момент.
- **`School`**: `Building` - Место учебы.
- **`Profession`**: `JobType` - Профессия.
- **`IsEmployed`**: `bool` - Флаг, указывающий, трудоустроен ли житель.
- **`Workplace`**: `Building` - Место работы.
- **`Salary`**: `decimal` - Зарплата.
- **`IsMarried`**: `bool` - Семейное положение.
- **`Partner`**: `Citizen` - Супруг(а).
- **`Children`**: `List<Citizen>` - Список детей.
- **`CanReproduce`**: `bool` (только для чтения) - Определяет, может ли житель иметь детей (возраст 18-45 лет, состоит в браке).
- **`Home`**: `ResidentialBuilding` - Место жительства.
- **`Health`**: `float` - Уровень здоровья (от 0 до 100).
- **`DestinationBuilding`**: `Building` - Конечная цель перемещения (например, `Workplace`, `School`, `Home`).
- **`TargetTransitStation`**: `TransitStation` - Остановка, к которой гражданин направляется или на которой ждет транспорт.
- **`CurrentTransport`**: `Transport` - Текущий транспорт, в котором находится гражданин. `null`, если идет пешком или ждет.
- **`IsWaitingForTransport`**: `bool` (только для чтения) - Возвращает `true`, если гражданин находится на тайле `TargetTransitStation` и ждет.
- **`IsOnTransport`**: `bool` (только для чтения) - Возвращает `true`, если `CurrentTransport` не равен `null`.
- **`IsMoving`**: `bool` (только для чтения) - Возвращает `true`, если гражданин имеет цель (`DestinationBuilding` или `TargetTransitStation`) или находится в транспорте.

### Свойства системы счастья

- **`Happiness`**: `float` - Уровень счастья жителя (от 0 до 100). Влияет на здоровье, продуктивность и демографию.

### Методы поведения

- **`Move()`**: `override void`. Управляет состояниями движения:
- Состояние: Едет в транспорте (`IsOnTransport` = true)
  - Гражданин ничего не делает, его координаты обновляет сам транспорт.
  - Если транспорт прибыл в зону `DestinationBuilding`, гражданин вызывает `TryDisembarkFromTransport()`.
- Состояние: Ждет на остановке (`IsWaitingForTransport` = true)
  - Гражданин бездействует. Логика посадки будет инициирована прибывшим общественным транспортом.
- Состояние: Нет цели (`DestinationBuilding` = null)
  - Вызывается `DecideDestination()` для выбора новой цели (например, работа, учеба, дом).
- Состояние: Движение к цели
  - Если цель далеко (расстояние > 10 тайлов), гражданин ищет ближайшую `TransitStation` (`FindNearestTransitStation()`).
  - Он движется пешком к этой остановке. Как только прибывает, регистрируется в `TransitStation.WaitingCitizens` и переходит в состояние ожидания (2).
  - Если цель близко, или рядом нет рабочих остановок, гражданин идет пешком прямо к `DestinationBuilding`.

- **`TryReproduce()`**: `bool`
  - Пытается произвести потомство. Успех зависит от шанса (в текущей реализации 10%).
- **`Work()`**: `void`
  - Метод для выполнения рабочей логики. После работы автоматически вызывается `ApplyHappinessEffects()`.
- **`Study()`**: `void`
  - Метод для выполнения логики обучения.

### Методы системы счастья

- **`UpdateHappinessBasedOnInfrastructure()`**: `void`
  - Обновляет уровень счастья жителя в зависимости от окружающей инфраструктуры и условий жизни.
  
  **Факторы увеличения счастья:**
  - Нахождение на тайле с парком (`HasPark`): +0.1
  - Нахождение на тайле с велодорожкой (`HasBikeLane`): +0.05
  - Нахождение на тайле с пешеходной дорожкой (`HasPedestrianPath`): +0.03
  - Проживание в доме с коммунальными услугами (`Home.IsOperational`): +0.02
  - Работа на предприятии с коммунальными услугами (`Workplace.IsOperational`): +0.01

  **Фактор уменьшения счастья:**
  - Естественное снижение со временем: -0.01

- **`ApplyHappinessEffects()`**: `void`
  - Применяет эффекты счастья на здоровье и демографию жителя.
  
  **Влияние на здоровье:**
  - Высокое счастье (>70): постепенное улучшение здоровья (+0.05)
  - Низкое счастье (<30): постепенное ухудшение здоровья (-0.1)
  
  **Влияние на демографию:**
  - Высокое счастье (>80) увеличивает шанс размножения до 15%

## Глава 3: Bus.cs
`Bus` — конкретная реализация общественного транспорта. Наследуется от `PublicTransport`.

### Константы
`DefaultBusCapacity`: `80`
`DefaultBusSpeed`: `10f` (Условная скорость движения).

### Методы
- `Move()`: `override void`
  - Реализует движение по заданному цикличному маршруту (`Route`).
  - Автобус движется к `Route[NextWaypointIndex]`.
  - При достижении точки маршрута (distance < 0.5):
    - Он переключается на следующий `NextWaypointIndex`.
    - TODO: Здесь необходимо добавить логику для остановки, высадки пассажиров, достигших своей цели, и посадки ожидающих граждан с `BusStop`.
  - В конце цикла обновляются координаты всех пассажиров (`Passengers`).

## Глава 4: Взаимодействие систем

### Связь с пешеходной инфраструктурой

Система счастья жителей напрямую зависит от развития пешеходной инфраструктуры:
- Парки оказывают наибольшее положительное влияние
- Велодорожки и пешеходные дорожки создают комфортную среду
- Регулярное перемещение по благоустроенным территориям поддерживает высокий уровень счастья

### Связь с системой ЖКХ

Наличие коммунальных услуг в доме и на работе значительно влияет на удовлетворенность жизнью:
- Отключение электричества, воды, газа или канализации снижает счастье
- Полноценное обеспечение услугами ЖКХ повышает качество жизни

### Влияние на городские показатели

Высокий уровень счастья населения приводит к:
- Улучшению общего здоровья горожан
- Росту рождаемости
- Повышению продуктивности на рабочих местах
- Снижению нагрузки на систему здравоохранения

---