# Документация по сервисам (Services)

Этот документ описывает сервисные классы, отвечающие за управление различными системами города.

## Глава 1: ConstructionCompany.cs

`ConstructionCompany` — это **сервисный класс**, отвечающий за логику создания и размещения всех типов зданий в игре.

### Основная логика

- Класс получает в конструкторе экземпляр `PlayerResources`, из которого берет информацию о балансе и материалах игрока.
- Метод `TryBuild<T>` является универсальным строителем для любого здания, наследующего `Building` и `IConstructable<T>`.

### Методы

- **`TryBuild<T>(...)`**: `bool`
  - Проверяет, достаточно ли у игрока денег (`BuildCost`) и материалов (`RequiredMaterials`), которые он получает из статических полей класса `T`.
  - Если все проверки пройдены, вычитает ресурсы из `PlayerResources`, создает экземпляр здания, размещает его на карте и возвращает `true`.

## Глава 2: UtilityService.cs

`UtilityService` — сервис управления одной коммунальной услугой (ЖКХ). Отвечает за подключение зданий к конкретной сети и управление ее состоянием.

### Свойства

- **`ServiceType`**: `UtilityType` - Тип коммунальной услуги (Electricity, Water, Gas, Sewage).
- **`ConnectedBuildings`**: `List<Building>` - Список зданий, подключенных к этой сети.
- **`IsNetworkOperational`**: `bool` - Работает ли сеть (true - работает, false - авария/отключение).

### Методы

- **`ConnectBuilding(Building building)`**: `void` - Подключает здание к сети.
- **`DisconnectBuilding(Building building)`**: `void` - Отключает здание от сети.
- **`SetNetworkState(bool isOperational)`**: `void` - Включает или выключает всю сеть, обновляя состояние всех подключенных зданий.
- **`GetConnectedBuildingsCount()`**: `int` - Возвращает количество подключенных зданий.

## Глава 3: NatureManager.cs

`NatureManager` - менеджер для управления природными объектами (деревьями) на карте.

### Основная функциональность

- Посадка деревьев на указанных тайлах
- Очистка деревьев с тайлов
- Получение статистики по деревьям на карте
- Подсчет общего количества деревьев

### Методы

- **`PlantTrees(GameMap map, int x, int y, TreeType treeType, int count = 1)`**: `void`
  - Сажает деревья указанного типа на тайле. Количество автоматически ограничивается диапазоном 1-10.

- **`ClearTrees(GameMap map, int x, int y)`**: `void`
  - Очищает все деревья с указанного тайла.

- **`GetTotalTreeCount(GameMap map)`**: `int`
  - Возвращает общее количество деревьев на карте.

- **`GetTilesWithTreesCount(GameMap map)`**: `int`
  - Возвращает количество тайлов, на которых есть деревья.

- **`GetTreeTypeStatistics(GameMap map)`**: `Dictionary<TreeType, int>`
  - Возвращает статистику по типам деревьев на карте.

## Глава 4: UtilityManager.cs

`UtilityManager` — менеджер для централизованного управления всеми коммунальными услугами города.

### Свойства

- **`UtilityServices`**: `Dictionary<UtilityType, UtilityService>` - Коллекция всех сервисов ЖКХ, создаваемая в конструкторе.

### Методы

- **`ConnectBuildingToAllUtilities(Building building)`**: `void` - Подключает здание ко всем коммунальным услугам одновременно.
- **`DisconnectBuildingFromAllUtilities(Building building)`**: `void` - Отключает здание от всех коммунальных услуг.
- **`GetUtilityStatistics()`**: `void` - Собирает статистику по всем подключенным зданиям.

## Глава 5: ParkManager.cs

`ParkManager` — менеджер для управления парками и пешеходной инфраструктурой города.

### Методы

- **`CreatePark(GameMap map, ...)`**: `void` - Создает парк на указанной территории.
- **`CreateBikeLane(GameMap map, ...)`**: `void` - Создает велодорожку.
- **`GetHappyTilesCount(GameMap map)`**: `int` - Возвращает количество "счастливых" тайлов (с парками или велодорожками).

## Глава 6: MapGeneratorService.cs

`MapGeneratorService` — сервис для генерации игровой карты. *На данный момент является заглушкой и не содержит логики.*

## Глава 7: DisasterManager.cs

`DisasterManager` — сервисный класс, отвечающий за управление бедствиями в игре. Обрабатывает создание, обновление и завершение событий бедствий.

### Свойства

- **`ActiveEvents`**: `List<DisasterEvent>` - Список активных событий бедствий.
- **`Map`**: `GameMap` - Игровая карта для применения эффектов бедствий.
- **`UtilityManager`**: `UtilityManager` - Менеджер утилит для управления коммунальными услугами.
- **`BaseDisasterChances`**: `Dictionary<DisasterType, double>` - Базовые шансы возникновения различных типов бедствий.

### События

- **`OnDisasterStarted`**: `Action<DisasterEvent>` - Возникает при начале бедствия.
- **`OnDisasterEnded`**: `Action<DisasterEvent>` - Возникает при завершении бедствия.

### Методы

- **`Update()`**: `void` - Обновление состояния менеджера бедствий, обрабатывает активные события и проверяет новые случайные бедствия.
- **`TriggerDisaster(DisasterType type, ...)`**: `void` - Запуск бедствия указанного типа с возможностью настройки параметров.
- **`GetDisasterReport()`**: `string` - Получение отчета о текущих активных бедствиях.
- **`StopAllDisasters()`**: `void` - Остановка всех активных бедствий.

## Глава 8: HRManager.cs

`HRManager` — сервисный класс для управления персоналом организации. Обрабатывает создание отделов, найм и увольнение сотрудников.

### Свойства

- **`Departments`**: `IReadOnlyList<Department>` - Список всех отделов организации.
- **`Employees`**: `IReadOnlyList<Employee>` - Список всех сотрудников организации.

### Методы

- **`CreateDepartment(string name, DepartmentType type, Building location)`**: `Department` - Создание нового отдела с указанными параметрами.
- **`HireCitizen(Citizen citizen, Department department, decimal salary)`**: `Employee` - Наем гражданина в указанный отдел с заданной зарплатой.
- **`FireEmployee(Employee employee)`**: `bool` - Увольнение сотрудника из организации.
- **`GetEmployeesByProfession(JobType profession)`**: `List<Employee>` - Получение списка сотрудников по указанной профессии.
- **`GetTotalEmployees()`**: `int` - Получение общего количества сотрудников в организации.
- **`GetTotalSalaries()`**: `decimal` - Получение общей суммы зарплат всех сотрудников.

## Глава 9: Взаимодействие систем

### Интеграция ЖКХ с другими модулями

- **Производственные здания**: Требуют электричество для работы оборудования.
- **Жилые здания**: Требуют все коммунальные услуги для комфортного проживания.
- **Общественные здания**: Требуют коммунальные услуги для предоставления услуг.

### Интеграция пешеходной инфраструктуры

- **Система счастья**: Парки и велодорожки увеличивают счастье жителей.
- **Перемещение**: Пешеходные дорожки улучшают маршруты перемещения.
- **Экология**: Зеленые зоны положительно влияют на экологию города.

### Интеграция системы бедствий

- **Влияние на здания**: Все типы бедствий наносят урон состоянию зданий и могут нарушать работу коммунальных сетей.
- **Влияние на природу**: Пожары и промышленные аварии уничтожают деревья и парки.
- **Влияние на транспорт**: Землетрясения могут разрушать дорожную инфраструктуру.
- **Влияние на жителей**: Пожары и утечки газа снижают здоровье и счастье граждан.

### Интеграция системы управления персоналом

- **Связь с гражданами**: Сотрудники являются гражданами города с профессиями и характеристиками.
- **Бюджетирование**: Отделы имеют ограниченный бюджет для выплаты зарплат.
- **Квалификация**: Автоматическое определение грейда сотрудника по профессии.
- **Лимиты найма**: Ограничение количества сотрудников в отделах.
- **Влияние на экономику**: Зарплаты сотрудников влияют на экономику города.

---