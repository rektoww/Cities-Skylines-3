# Документация StaticMapProvider.cs

## Назначение

`StaticMapProvider` создаёт и возвращает экземпляр `GameMap`, заполняя каждую клетку (`Tile`) типом рельефа (`Terrain`), ресурсами (`Resources`) и природными объектами согласно двум «текстовым маскам». Это удобно для лабораторной работы: карта детерминирована, легко редактируется прямо в коде и всегда воспроизводима.

## Архитектура и принцип работы

### Схема работы:
1. **Объявление масок** - два массива строк одинаковой высоты:
   - `terrainRows` - рельеф и природа
   - `resourceRows` - ресурсы
2. **Проверка размеров** - убеждается, что высота обеих масок совпадает
3. **Вычисление геометрии** - ширина карты определяется как максимальная длина строки среди обеих масок
4. **Создание карты** - инициализируется `GameMap(width, height)` с массивом `Tile[,]`
5. **Заполнение клеток** - для каждой клетки `(x, y)`:
   - Читается символ рельефа (за пределами строки подставляется '.' = равнина)
   - Читается символ ресурса (за пределами строки - «нет ресурса»)
   - Назначаются свойства тайла: `Terrain`, `Resources`, деревья

## Легенда масок

### Рельеф и природа (terrainRows):
- `~` - **Water** (вода)
- `^` - **Mountain** (гора)
- `#` - **Mountain** (скальное плато)
- `T` - **Forest** (лес) - автоматически получает деревья
- `M` - **Meadow** (луг) - может получить редкие деревья
- `.` - **Plain** (равнина)
- Любой другой символ - по умолчанию **Plain**

### Ресурсы (resourceRows):
- `I` - **Iron** (железо) - 200 единиц
- `O` - **Oil** (нефть) - 200 единиц  
- `G` - **Gas** (газ) - 200 единиц
- Любой другой символ - «ресурса нет»

## Система природы

### Автоматическая генерация деревьев:

**Для лесов (Terrain = Forest):**
- Автоматически назначается случайный тип дерева
- Количество деревьев: 5-10 случайных
- Плотность растительности: высокая

**Для лугов (Terrain = Meadow):**
- 30% вероятность появления деревьев
- Количество деревьев: 1-3 случайных (при наличии)
- Плотность растительности: средняя

**Типы деревьев:**
- `Oak` (Дуб)
- `Pine` (Сосна) 
- `Birch` (Береза)
- `Spruce` (Ель)

## Ключевые зависимости

### Модели:
- `GameMap` - содержит `Width`, `Height` и двумерный массив `Tiles` типа `Tile[,]`
- `Tile` - координаты `X`, `Y`, `Terrain`, список `Resources`, свойства природы
- `NaturalResource` - поля `Type`, `Amount`

### Перечисления:
- `TerrainType` (Water, Plain, Mountain, Forest, Meadow)
- `ResourceType` (Iron, Oil, Gas)
- `TreeType` (Oak, Pine, Birch, Spruce)

## Важные детали реализации

### Индексация тайлов:
- Доступ к клетке: `map.Tiles[x, y]` (двумерный массив)
- **Не использовать**: `map.Tiles[x][y]`

### Защита от ошибок:
- Короткие строки автоматически дополняются символами равнины
- Проверка границ массива при обращении к тайлам
- Обработка невалидных символов в масках

### Детерминизм:
- Отсутствие рандомизации гарантирует одинаковую карту при каждом запуске
- Идеально для тестирования и воспроизводимости

## Как редактировать карту

### Шаги по изменению:
1. Откройте метод `StaticMapProvider.Build()`
2. Найдите массивы `terrainRows` и `resourceRows`
3. Редактируйте строки, соблюдая легенду символов
4. Сохраните файл - изменения применятся при следующем запуске

### Пример редактирования:
```csharp
string[] terrainRows =
{
    "~~~~~~~~~~~~~~~~~~~~~~~",
    "~~~~.....^^^^.....~~~~~", 
    "~~~..TTT.^^^^......~~~~",  // Добавили лес
    "~~..TTT..^^^.......~~~~",
    "~...TT...^^........~~~~",
    "~.....TTT....MM....~~",    // Добавили лес и луг
    "~....######..MMM.....~",   // Добавили луг
    "~.......MMM.........~~",
    // ... остальные строки
}